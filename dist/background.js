chrome.runtime.onInstalled.addListener(e=>{e.reason==="install"?(console.log("YouTube Summarizer extension installed"),chrome.storage.sync.set({summaryLength:"medium",autoSummarize:!1,apiKey:""})):e.reason==="update"&&console.log("YouTube Summarizer extension updated")});chrome.action.onClicked.addListener(e=>{e.url?.includes("youtube.com/watch")?console.log("Extension clicked on YouTube video page"):console.log("Extension clicked on non-YouTube page")});chrome.runtime.onMessage.addListener((e,a,t)=>{switch(e.action){case"saveSettings":return chrome.storage.sync.set(e.settings,()=>{t({success:!0})}),!0;case"getSettings":return chrome.storage.sync.get(["summaryLength","autoSummarize","apiKey"],u=>{t(u)}),!0;case"storeSummary":const r=s(e.url);return r&&chrome.storage.local.set({[`summary_${r}`]:{summary:e.summary,timestamp:Date.now(),title:e.title}}),t({success:!0}),!0;case"getSummary":const o=s(e.url);return o?chrome.storage.local.get([`summary_${o}`],u=>{t(u[`summary_${o}`]||null)}):t(null),!0;default:console.log("Unknown message action:",e.action)}});function s(e){const a=/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/,t=e.match(a);return t?t[1]:null}chrome.tabs.onUpdated.addListener((e,a,t)=>{a.status==="complete"&&t.url?.includes("youtube.com/watch")&&(console.log("YouTube video page loaded:",t.url),chrome.storage.sync.get(["autoSummarize"],r=>{r.autoSummarize&&chrome.tabs.sendMessage(e,{action:"autoSummarize"})}))});chrome.storage.local.get(null,e=>{const a=Object.keys(e).filter(t=>t.startsWith("summary_"));if(a.length>50){const t=a.map(o=>({key:o,timestamp:e[o].timestamp||0}));t.sort((o,u)=>u.timestamp-o.timestamp);const r=t.slice(50).map(o=>o.key);chrome.storage.local.remove(r)}});
